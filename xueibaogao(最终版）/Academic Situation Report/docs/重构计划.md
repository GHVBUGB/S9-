# 代码重构计划

## 第一阶段：代码架构与质量清洗

### 当前问题分析

#### 1. 超大文件需要拆分
- ❌ **EditModal.tsx** (849行) - 编辑弹窗包含过多逻辑
- ❌ **StudentReportView.tsx** (539行) - 学生报告视图过于臃肿
- ⚠️ **SalesScriptPage.tsx** (484行) - 销售话术页面接近上限
- ⚠️ **StudentReportView_New.tsx** (482行) - 新版报告视图接近上限

#### 2. 目录结构问题
- 缺少统一的hooks目录
- 缺少统一的utils工具函数目录
- 缺少统一的constants常量目录
- components下需要更清晰的模块划分

### 新目录结构设计

```
Academic Situation Report/
├── src/
│   ├── components/              # 组件目录
│   │   ├── common/             # 通用组件
│   │   │   ├── Button/
│   │   │   ├── Card/
│   │   │   └── Modal/
│   │   ├── business/           # 业务组件
│   │   │   ├── 报告相关/
│   │   │   │   ├── StudentReportView/   # 学生报告视图模块
│   │   │   │   │   ├── index.tsx          # 主组件（<200行）
│   │   │   │   │   ├── Header.tsx         # 报告头部
│   │   │   │   │   ├── DailyStats.tsx     # 今日数据
│   │   │   │   │   ├── TrainingSection.tsx# 训练目标
│   │   │   │   │   ├── VocabSection.tsx   # 生词账单
│   │   │   │   │   ├── SentenceSection.tsx# 难句手术
│   │   │   │   │   ├── PassportSection.tsx# 主题护照
│   │   │   │   │   ├── SkillSection.tsx   # 技能卡
│   │   │   │   │   ├── RadarSection.tsx   # 能力雷达
│   │   │   │   │   └── TrendSection.tsx   # 趋势分析
│   │   │   │   │
│   │   │   │   ├── SalesScriptPage/     # 销售话术模块
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── Header.tsx
│   │   │   │   │   ├── EditableSection.tsx
│   │   │   │   │   └── ScriptSections.tsx
│   │   │   │   │
│   │   │   │   └── EditModal/          # 编辑弹窗模块
│   │   │   │       ├── index.tsx        # 主弹窗（<200行）
│   │   │   │       ├── BasicInfoForm.tsx      # 基础信息表单
│   │   │   │       ├── VocabularyForm.tsx     # 词汇表单
│   │   │   │       ├── SentenceForm.tsx       # 句子表单
│   │   │   │       ├── SkillCardsForm.tsx     # 技能卡表单
│   │   │   │       ├── TrainingGoalsForm.tsx  # 训练目标表单
│   │   │   │       └── AbilityScoresForm.tsx  # 能力分数表单
│   │   │   │
│   │   │   ├── 看板相关/
│   │   │   │   ├── TeacherDashboard/
│   │   │   │   │   ├── index.tsx
│   │   │   │   │   ├── StudentSearch.tsx
│   │   │   │   │   ├── LessonHistory.tsx
│   │   │   │   │   └── ReportActions.tsx
│   │   │   │   └── ...
│   │   │   │
│   │   │   └── 图表相关/
│   │   │       ├── RadarChart/
│   │   │       ├── TrendChart/
│   │   │       └── ReadingSpeedChart/
│   │   │
│   │   └── layout/             # 布局组件
│   │       ├── PageContainer/
│   │       └── Modal/
│   │
│   ├── hooks/                  # 自定义Hooks
│   │   ├── useStudentData.ts   # 学生数据Hook
│   │   ├── useLessonEdit.ts    # 课程编辑Hook
│   │   ├── useReportGeneration.ts # 报告生成Hook
│   │   └── index.ts
│   │
│   ├── utils/                  # 工具函数
│   │   ├── dataConverter.ts    # 数据转换
│   │   ├── validation.ts       # 数据验证
│   │   ├── formatters.ts       # 格式化工具
│   │   └── index.ts
│   │
│   ├── constants/              # 常量配置
│   │   ├── ui-text.ts         # UI文本（所有硬编码文字）
│   │   ├── api-endpoints.ts    # API端点
│   │   ├── colors.ts           # 颜色配置
│   │   ├── skill-cards.ts      # 技能卡配置
│   │   └── index.ts
│   │
│   ├── types/                  # 类型定义
│   │   ├── student.ts          # 学生相关类型
│   │   ├── lesson.ts           # 课程相关类型
│   │   ├── report.ts           # 报告相关类型
│   │   └── index.ts
│   │
│   ├── services/               # 服务层（API调用）
│   │   ├── studentService.ts   # 学生服务
│   │   ├── lessonService.ts    # 课程服务
│   │   ├── reportService.ts    # 报告服务
│   │   └── index.ts
│   │
│   ├── config/                 # 配置文件
│   │   ├── constants.ts
│   │   └── locales.ts
│   │
│   └── data/                   # 数据文件
│       ├── mockData.ts
│       └── ...
│
├── docs/                       # 文档目录
│   ├── 业务字段映射表.md
│   ├── 重构计划.md
│   └── API对接文档.md
│
└── public/                     # 静态资源
    └── ...
```

### 拆分原则

1. **单一职责原则**
   - 每个文件只负责一个明确的功能
   - 组件不超过300行代码

2. **可维护性原则**
   - 每个模块独立一个文件夹
   - 包含index.tsx作为入口
   - 相关的子组件放在同一目录

3. **可读性原则**
   - 文件名清晰表达功能
   - 每个文件开头添加功能说明注释
   - 复杂逻辑必须添加注释

### 拆分优先级

#### Priority 1: EditModal (849行)
拆分为：
- `EditModal/index.tsx` - 主弹窗容器（<150行）
- `EditModal/BasicInfoForm.tsx` - 基础信息表单
- `EditModal/VocabularyForm.tsx` - 词汇管理
- `EditModal/SentenceForm.tsx` - 句子管理
- `EditModal/SkillCardsForm.tsx` - 技能卡管理
- `EditModal/TrainingGoalsForm.tsx` - 训练目标
- `EditModal/AbilityScoresForm.tsx` - 能力分数

#### Priority 2: StudentReportView (539行)
拆分为：
- `StudentReportView/index.tsx` - 主视图容器（<150行）
- `StudentReportView/Header.tsx` - 报告头部
- `StudentReportView/DailyStats.tsx` - 每日数据卡片
- `StudentReportView/TrainingSection.tsx` - 训练目标
- `StudentReportView/VocabSection.tsx` - 生词账单
- `StudentReportView/SentenceSection.tsx` - 难句手术
- `StudentReportView/PassportSection.tsx` - 主题护照
- `StudentReportView/SkillSection.tsx` - 技能卡
- `StudentReportView/RadarSection.tsx` - 能力雷达
- `StudentReportView/TrendSection.tsx` - 趋势分析

#### Priority 3: SalesScriptPage (484行)
拆分为：
- `SalesScriptPage/index.tsx` - 主页面（<150行）
- `SalesScriptPage/Header.tsx` - 顶部导航
- `SalesScriptPage/TitlePage.tsx` - 标题页
- `SalesScriptPage/EditableSection.tsx` - 可编辑段落组件
- `SalesScriptPage/ScriptSections.tsx` - 话术内容区域

### 下一步行动

1. ✅ 修复jimeng拼写错误
2. ⏳ 创建新的目录结构
3. ⏳ 拆分EditModal
4. ⏳ 拆分StudentReportView
5. ⏳ 拆分SalesScriptPage
6. ⏳ 提取所有硬编码文本到constants
7. ⏳ 添加函数注释
8. ⏳ 清理未使用的imports
9. ⏳ 创建字段映射表

